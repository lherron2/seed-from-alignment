# example/pipeline_config.yaml

# -----------------------------------------------------------------------------
# Input & Executables
# -----------------------------------------------------------------------------
sto: "../vegf/vegf_1.cacofold.sto"
cov: "../vegf/vegf_1.cacofold.cov"  # Optional R-scape covariation file
seq_name: "vegf"

# Paths to RNAstructure executables (Required for refinement)
allsub_exe: "/home/lukas/research/RNAstructure/exe/AllSub"
duplex_exe: "/home/lukas/research/RNAstructure/exe/DuplexFold"

# -----------------------------------------------------------------------------
# Output Paths
# -----------------------------------------------------------------------------
io:
  work_dir: "../vegf/output"
  consensus_db: "00_consensus.db"
  refined_db: "01_refined.db"
  sampled_db: "02_sampled.db"
  rosetta_db: "04_rosetta.db"
  summary: "summary.txt"

# -----------------------------------------------------------------------------
# 1. Sampling Configuration (CaCoFold + Metropolis PK Sampling)
# -----------------------------------------------------------------------------
sample:
  n_samples: 1
  burn_in: 2000
  thin: 10
  beta: 1.0
  seed: 42
  min_loop_sep: 1
  
  # Pseudoknot Complexity Filters
  pk_alpha: 2.0
  pk_filter_frac: 0.2
  pk_filter_max_cross_per_pair: 2
  pk_filter_max_total_cross: 30
  
  # Covariation Weighting (Optional)
  cov_mode: "logE"
  cov_alpha: 3

# -----------------------------------------------------------------------------
# 2. Refinement Configuration (Unpaired Regions -> AllSub/DuplexFold)
# -----------------------------------------------------------------------------
refine:
  min_unpaired: 4
  temperature: 310.15    # Kelvin (37 C)
  max_structures: 500000   # Max unique structures to output after refinement
  
  # --- Consensus Masking Grid ---
  # Controls how aggressively we strip parts of the consensus to force exploration
  end_mask_step: 5           # Step size (nt) for incrementally unpairing 5' and 3' ends
  max_end_mask_len: 40       # Max length (nt) to unpair from either end
  max_helices_sequential: 20 # Top N helices to attempt removing one-by-one
  max_helices_pairwise: 10   # Top N helices to attempt removing in pairs

  # --- Initialization Seeds ---
  max_seeds: 50              # Max global 5'-3' interaction seeds to compute per mask variant

  allsub_abs: 15

  # --- Combinatorial Heuristics ---
  max_regions_to_refine: 40  # Safety cap: only refine the N largest unpaired runs
  max_solutions: 20000        # Max combinatorial solutions to keep per search track
  kissing_loop_candidates: 200000 # Number of top refined structures to scan for kissing loops

  # --- Topology-Aware Scoring Weights ---
  # Final Score = Sum(Weight(Layer) * Energy)
  scaffold_pair_energy: -1.5 # Pseudo-energy (kcal/mol) assigned to fixed scaffold pairs
  weight_l0: 1.0             # Weight for Nested pairs (Layer 0)
  weight_l1: 0.6             # Weight for PK Layer 1 (minor penalty/reduced stability)
  weight_l2_plus: -1.0       # Weight for PK Layer 2+ (Major penalty)

# -----------------------------------------------------------------------------
# 3. Rosetta Conversion & Deduplication
# -----------------------------------------------------------------------------
rosetta:
  hamming_threshold: 0       # 0 = Exact duplicates only
  hamming_frac: 0.05         # Fraction of length allowed to differ (if threshold > 0)
